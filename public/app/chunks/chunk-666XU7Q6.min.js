import{$a as u,$b as f,Ra as R,Sa as l,Ua as g,Va as h,Ya as m,Zb as c,cc as y,ec as C}from"https://app.gitbook.com/public/app/chunks/chunk-E7KOX4IY.min.js";import{p as L}from"https://app.gitbook.com/public/app/chunks/chunk-UVYKISNP.min.js";import{b as d}from"https://app.gitbook.com/public/app/chunks/chunk-YPOOS4GR.min.js";import{e as B,l as a}from"https://app.gitbook.com/public/app/chunks/chunk-OAKVUAEN.min.js";a();function q(e){return u(e).collection("change-requests")}function k(e,t){return q(e).doc(t)}function I(e,t){return q(e).where("number","==",t).limit(1)}a();var w=B(L());function G(e){let[t]=E([e]);return t}function E(e){return F(e).map((r,n)=>{if(!r)return null;if(r.state==="failed")throw r.error;return r.result})}function F(e){let t=D(e);return b(e),t}function W(e,t){let s=w.useRef(new Map),[r,n]=A([e,s.current.get(t)||null]);if(b([e]),!r)return null;let o=n&&(n.state==="live"||n.state==="cached");switch(r==null?void 0:r.state){case"live":case"cached":return r.result===null&&o?n.result:(s.current.set(t,e),r.result);case"failed":throw r.error;case"pending":if(o)return n.result;throw r.pending;default:d(r)}}function b(e){let t=f(e.map(s=>s?v(s):null));y(t.map(s=>{let r=s==null?void 0:s.result;return!r||!r.conflicts?null:R(r.space,r.key)})),C(e.map((s,r)=>{if(!s)return[];let n=t[r],o=n==null?void 0:n.result,p=o?m(o):[];return[v(s),...p.map(i=>l(s.space,i.revisionKey,i.chunkKey))]}).flat())}function D(e){return A(e).map(s=>{if(!s)return null;if(s.state==="pending")throw s==null?void 0:s.pending;return s})}function A(e){return e.map(t=>{if(!t)return null;let[s]=typeof t.revision=="string"?f([v(t)]):[{state:"live",result:t.revision}];if(!s)return null;if(s.state==="failed"||s.state==="pending"||!s.result)return s;let r=f(m(s.result).map(i=>l(t.space,i.revisionKey,i.chunkKey))),n=[],o=[];if(r.forEach(i=>{if(i.state==="pending")n.push(i.pending);else{if(i.state==="failed")throw i.error;if(i.result)o.push(i.result);else throw new Error("Chunk not found")}}),n.length>0)return{state:"pending",pending:Promise.all(n).then(()=>null)};let p=g({revision:s.result,chunks:o});return{state:s.state,result:p}})}function Q(e){let[t]=D([e]);if((t==null?void 0:t.state)==="failed")throw t.error;return t?t.result:null}async function x(e){return h(e.space,typeof e.revision=="string"?e.revision:e.revision.key,{reader:{getDocument:async t=>{let[s]=await c([t]);return s}}})}async function H(e){let t;if(e.changeRequestKey){let r=k(e.spaceKey,e.changeRequestKey),[n]=await c([r]);if(!n)throw new Error("change request expected");t=n.revisionCurrent}else{let r=u(e.spaceKey),[n]=await c([r]);if(!n)throw new Error("space expected");t=n.revision}let s=await x({space:e.spaceKey,revision:t});if(!s)throw new Error("revision expected");return s}function v(e){return R(e.space,typeof e.revision=="string"?e.revision:e.revision.key)}export{k as a,I as b,G as c,E as d,F as e,W as f,D as g,Q as h,H as i};
//# sourceMappingURL=https://app.gitbook.com/public/app/chunks/chunk-666XU7Q6.min.js.map
