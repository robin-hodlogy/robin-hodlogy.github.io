import{c as Le,d as Ne}from"https://app.gitbook.com/public/app/chunks/chunk-TKQUUXTQ.min.js";import{e as Re,f as G,i as ne}from"https://app.gitbook.com/public/app/chunks/chunk-Z7LFZF6N.min.js";import{a as oe,b as Oe}from"https://app.gitbook.com/public/app/chunks/chunk-AHWZKYOT.min.js";import{s as xe}from"https://app.gitbook.com/public/app/chunks/chunk-NZESLSKN.min.js";import{$a as x,V as A,W as He,Xb as ae,a as ge,ab as te,b as de,eb as we,hb as I,ib as ve,ja as Se,ka as y,qa as Xe}from"https://app.gitbook.com/public/app/chunks/chunk-E7KOX4IY.min.js";import{Wa as $,Xa as X,a as J,bb as F,cb as Y,eb as Z,fb as ee,g as pe,gb as Pe,hb as B,ib as Ce,j as L,lb as g}from"https://app.gitbook.com/public/app/chunks/chunk-EFJ6CI7R.min.js";import{b as _}from"https://app.gitbook.com/public/app/chunks/chunk-HCFMPDL2.min.js";import{a as ye,c as R}from"https://app.gitbook.com/public/app/chunks/chunk-CIHAFBKJ.min.js";import{a as he}from"https://app.gitbook.com/public/app/chunks/chunk-XQJO7322.min.js";import{P as fe,na as N,oa as be,p as j}from"https://app.gitbook.com/public/app/chunks/chunk-UVYKISNP.min.js";import{b}from"https://app.gitbook.com/public/app/chunks/chunk-YPOOS4GR.min.js";import{e as E,l as s}from"https://app.gitbook.com/public/app/chunks/chunk-OAKVUAEN.min.js";s();s();function V(){return Ye()}function Ye(){return pe?"localhost:5001":L.content.publicDomain}s();var Ze=/^[a-z0-9][a-z0-9-]{1,30}[a-z0-9]$/;function ze(e){return Ze.test(e)&&e!=="www"&&e!=="hosting"}s();s();var Te=E(Xe());function Ue(){return X().collection("base-hostnames")}function z(e){return Ue().doc(e)}function Ct(e){let t=Ue();return t=t.where("type","==",e.type),"organization"in e?t=t.where("organization","==",e.organization):"user"in e&&(t=t.where("user","==",e.user)),t}function De(){return X().collection("custom-hostnames")}function ke(e){let t=De();return t=t.where("type","==",e.type),"organization"in e?t=t.where("organization","==",e.organization):"space"in e?t=t.where("space","==",e.space):"collection"in e&&(t=t.where("collection","==",e.collection)),t}function d(e){return De().doc(_(e))}function Ht(e){let t;switch(e.type){case"user":t=`u${e.user}`;break;case"organization":t=`o${e.organization}`;break}return t=Te.default.sha256().update(t).digest("hex").substring(0,10),`${t}-${L.content.cname}`.toLowerCase()}s();s();function Ee(e){switch(e.type){case"space":{let{space:t}=e;if(!t)throw new Error("Navigation screen space is required");return{type:"space",page:"",space:t,...e}}case"collection":{let{collection:t}=e;if(!t)throw new Error("Navigation screen collection is required");return{type:"collection",collection:t,...e}}default:return e}}function S(e,t){let o=et({...e,hash:void 0},typeof t=="function"?t(e):t);return Ee(o)}function et(e,t){switch(e.type){case"space":return t.type==="space"&&t.space&&e.space!==t.space?{...t}:{...e,...t};case"collection":return t.type==="collection"&&t.collection&&e.collection!==t.collection?{...t}:{...e,...t};default:return{...e,...t}}}function tt(e){return O(e).collection("paths")}function re(e,t){return tt(e).doc(_(t))}async function Zt(e,t){let o=new $("updateHostname");return o.label("Hostname",e),o.label("Owner",_e(t)),o.label("Type",t.type),o.wrap(async()=>{if(e.length===0||!ze(e))throw new R.UnprocessableEntity("Hostnames can only include lowercase alphanumeric characters and hyphens, cannot start or end with an hyphen and should be between 3 and 32 characters long.");await Y(async n=>{let r=O(t),a=await ee(n,r);if(a.hostname===e)return;let i=z(e),c=await Z(n,i);if(c&&!c.deprecated&&!ie(t,c))throw new ye(`Hostname "${e}" is already configured for a different profile.`,!0);n.set(i,{hostname:e,deprecated:!1,...t}),n.update(r,{hostname:e}),a.hostname&&n.update(z(a.hostname),{deprecated:!0})})})}function $e(e){return e.user!==void 0?{type:"user",user:e.user}:{type:"organization",organization:e.organization}}function en(e){return te(e)?{type:"space",space:e.id}:{type:"collection",collection:e.id}}var M=class extends Error{constructor(o,n){super(o);this.name="Domain already connected",this.existingCustomHostname=n}};async function tn(e,t){let o=O(t);if((await B(o)).customHostname===e)return!1;let r=d(e),a=await Pe(r);if(a&&!a.deprecated&&!ie(t,a))throw new M(`Domain "${e}" is already configured for a different content.`,a);return!0}async function nn(e,t){let o=new $("setupCustomHostname");return o.label("Custom Hostname",e),o.label("Owner",_e(t)),o.label("Type",t.type),o.wrap(async()=>Y(async n=>{let r=O(t),a=await ee(n,r);if(a.customHostname===e)return;let i=d(e),c=await Z(n,i);if(c&&!c.deprecated&&!ie(t,c))throw new M(`Domain "${e}" is already configured for a different content.`,c);n.set(i,{hostname:e,deprecated:!1,...t}),n.update(r,{customHostname:e}),a.customHostname&&n.update(d(a.customHostname),{deprecated:!0})}))}async function on(e,t){e.update(d(t),{status:J.firestore.FieldValue.delete()})}function nt(e,t,o){let n=O(o);e.update(d(t),{deprecated:!0}),e.update(n,{customHostname:J.firestore.FieldValue.delete()})}async function an(e){let t=new $("hardDeleteCustomHostname");return t.label("Custom Hostname",e),t.wrap(async()=>{let o=d(e);await Ce(async n=>{let r=await B(o),a=at(r),i=O(a);(await B(i)).customHostname===e&&nt(n,r.hostname,a)}),await o.delete()})}var ot=/^(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.){2,}[a-z0-9][a-z0-9-]{0,61}[a-z0-9]$/;function rn(e){return ot.test(e)&&e!=="hosting.gitbook.com"&&!e.endsWith("gitbook.io")&&!e.endsWith("gitbooks.io")&&!e.endsWith("gitbook.me")&&!e.endsWith("github.io")}function O(e){switch(e.type){case"user":return A(e.user);case"organization":return I(e.organization);case"space":return x(e.space);case"collection":return y(e.collection);default:b(e)}}function at(e){switch(e.type){case"organization":return{type:e.type,organization:e.organization};case"collection":return{type:e.type,collection:e.collection};case"space":return{type:e.type,space:e.space};default:b(e)}}function _e(e){switch(e.type){case"user":return e.user;case"organization":return e.organization;case"space":return e.space;case"collection":return e.collection;default:b(e)}}function sn(e){if(te(e))return{type:"space",space:e.id};if(Se(e))return{type:"collection",collection:e.id};if(He(e))return{type:"user",user:e.id};if(ve(e))return{type:"organization",organization:e.id};throw new Error("Wrong reference")}function ie(e,t){return e.type==="user"&&t.type==="user"&&e.user===t.user||e.type==="collection"&&t.type==="collection"&&e.collection===t.collection||e.type==="organization"&&t.type==="organization"&&e.organization===t.organization||e.type==="space"&&t.type==="space"&&e.space===t.space}async function Ln(e,t={}){let o=new g(t.reader);if(e.hostname.endsWith(`.${V()}`)){let n=await o.getDocument(z(e.hostname.split(".")[0]));if(!n)throw new R.NotFound("Content owner not found");let r=await Fe(n,e.pathname,t);return!r.deprecated&&r.pointer.type!=="user"&&(await ke(r.pointer).where("deprecated","==",!1).limit(1).get()).size>0&&(r.deprecated=!0),r}else{let n=await o.getDocument(d(e.hostname));if(!n)throw new R.NotFound("Domain not found");if(!n.status||n.status==="dns_wrong_cname"||n.status==="dns_no_cname"||n.status==="dns_cloudflare_proxied")throw new R.BadRequest("The custom domain for this content has not been correctly configured. If you are the owner of this page, verify that your custom domain is correctly set up in GitBook.");if(n.type==="space"||n.type==="collection"){let r=await(n.type==="collection"?Be(n.collection,e.pathname):null);return{pointer:n,basePathname:"",pathname:e.pathname,deprecated:n.deprecated||Boolean(r==null?void 0:r.deprecated),collectionVariantSpace:(r==null?void 0:r.type)==="space"?r.space:void 0}}return Fe(n,e.pathname,t)}}async function Fe(e,t,o={}){let n=new g(o.reader),r=t.split("/").filter(Boolean);if(r.length===0)return{pointer:e,basePathname:"",pathname:"",deprecated:e.deprecated};let a=r[0],i=await n.getDocument(re(e,a));if(!i)return{pointer:e,basePathname:"",pathname:t,deprecated:e.deprecated};let c=r.slice(1).join("/"),p=await(i.type==="collection"?Be(i.collection,c):null);return{pointer:i,basePathname:a,pathname:c,deprecated:e.deprecated||i.deprecated||Boolean(p==null?void 0:p.deprecated),collectionVariantSpace:(p==null?void 0:p.type)==="space"?p.space:void 0}}async function Be(e,t,o={}){let n=new g(o.reader),r=t.split("/").filter(Boolean),a=await n.assertDocument(y(e)),i=a.user?{type:"user",user:a.user}:a.organization?{type:"organization",organization:a.organization}:null;if(!i)return null;let c=r[0]==="v"?r[1]:void 0;return await(c?n.getDocument(re(i,c)):null)}async function se(e,t={},o={}){let n=new g(t.reader);if(e.type==="user"){let a=await n.assertDocument(A(e.user));return a.hostname?(o.didInsertShareLinkSuffix=!!t.withShareLinkSuffix,{hostname:`${a.hostname}.${V()}`,pathname:t.withShareLinkSuffix||""}):null}if(e.type==="organization"){let a=await n.assertDocument(I(e.organization));return!a.hostname&&!a.customHostname?null:(o.didInsertShareLinkSuffix=!!t.withShareLinkSuffix,{hostname:a.customHostname||`${a.hostname}.${V()}`,pathname:t.withShareLinkSuffix||""})}let r=await n.assertDocument(e.type==="space"?x(e.space):y(e.collection));return W(r,{...t,reader:n},{})}async function W(e,t={},o={}){let n=new g(t.reader),{withCollectionSuffix:r,withShareLinkSuffix:a}=t;if(e.visibility==="private")return null;if(e.customHostname)return o.didInsertShareLinkSuffix=!0,{hostname:e.customHostname,pathname:[a,r&&"v"].filter(Boolean).join("/")};if(!e.path)return null;let i=await ce(e,{...t,reader:n},o);if(!i)return null;let{didInsertShareLinkSuffix:c}=o;return o.didInsertShareLinkSuffix=!!a,o.isPrimarySpace?{hostname:i.hostname,pathname:!c&&a?`${i.pathname?`${i.pathname}/`:""}${a}`:i.pathname}:{hostname:i.hostname,pathname:[i.pathname,e.path,!c&&a,r&&"v"].filter(Boolean).join("/")}}async function ce(e,t={},o={}){let n=new g(t.reader);if(e.collection&&e.visibility==="in-collection"){let r=await n.assertDocument(y(e.collection)),a=r.primarySpace===e.key,i=await W(r,{...t,withCollectionSuffix:!a,reader:n},o);return o.isPrimarySpace=a,i}return se($e(e),{...t,withShareLinkSuffix:void 0,reader:n},o)}function Nn(e,t=""){return`${ge}://${e.hostname}/${rt(e.pathname)}${t.startsWith("/")?t.slice(1):t}`}function rt(e){return e?e.endsWith("/")?e:`${e}/`:""}s();var l=E(j());s();var K=N({getValue:e=>{let t=window.localStorage.getItem(e);if(t===null)return t;try{return JSON.parse(t)}catch(o){return null}}}),T={async set(e,t){window.localStorage.setItem(e,JSON.stringify(t)),K.write(e,t)},async remove(e){window.localStorage.removeItem(e),K.clear(e)},get(e){return K.read(e)},getAsync(e){return K.readAsync(e)},recoilEffect(e,t){return({trigger:o,setSelf:n,onSet:r})=>{if(!(typeof window>"u")){if(o==="get"){let a=T.get(e);n(a!==null?a:t)}r(a=>a instanceof fe?T.remove(e):T.set(e,a))}}}};s();function Ie(e,t,o){if("overlay"in t&&t.overlay!==null&&t.overlay!==void 0){let n=S(e.overlay||e.screen,t.overlay),r="screen"in t?S(e.screen,t.screen):e.screen;return{location:n,background:r,go:0}}if("overlay"in t&&t.overlay===null){if(!e.overlay){let a={type:"home"};return{location:"screen"in t&&t.screen?S(a,t.screen):a,background:void 0,go:0}}let r=Ae(o,a=>!!a.overlay);return{location:e.screen,background:void 0,go:r}}if("screen"in t){let n=S(e.screen,t.screen),r=le(e.screen),a=le(n),i=0;return r&&!a&&(i=Ae(o,c=>le(c.screen))),{location:n,background:void 0,go:i}}if("background"in t)return e.overlay?{location:e.overlay,background:S(e.screen,t.background),go:0}:void 0;if("current"in t)return{location:S(e.overlay||e.screen,t.current),background:e.overlay?e.screen:void 0,go:0}}function le(e){switch(e.type){case"space":return!!e.sideSheet||!!e.comments;case"collection":return!!e.sideSheet;default:return!1}}function Ae(e,t){if(e.length===0)return 0;let o=0;for(let n=e.length-1;n>=0&&(o=n-e.length,!!t(e[n]));n--);return o=Math.max(o,-(e.length-1)),o}s();function Ge({getNavigationScreenFromLocation:e,getLocationForNavigationScreen:t}){return o=>{var a;let n=e(o),r=(a=o.state)!=null&&a.background?e({pathname:o.state.background}):null;return!r||t(r).pathname===t(n).pathname?{screen:n}:{screen:r,overlay:n}}}s();var Ve=E(j());function Me(){let e=Ve.useContext(Le);if(!e)throw new Error("useHistoryLocation must be used within a <Router>");return e}var U=he("navigation"),it="@content:last-seen";function to(e){let{children:t,persist:o,forceHardNavigation:n=!1,getNavigationScreenFromLocation:r=Re,getLocationForNavigationScreen:a=G}=e,i=Ne(),c=Me(),[p,je]=l.useTransition(),w=l.useCallback(Ge({getNavigationScreenFromLocation:r,getLocationForNavigationScreen:a}),[r,a]),P=l.useRef([]);l.useEffect(()=>i.listen(({location:D,action:k})=>{let C=w(D);switch(U.info(`history action: ${k}`,{location:D,state:C}),k){case"PUSH":P.current.push(C);break;case"POP":P.current.pop(),P.current[P.current.length-1]=C;break;case"REPLACE":P.current.pop(),P.current.push(C);break}}),[i,w]);let q=l.useMemo(()=>w(c),[w,c]);l.useEffect(()=>{o&&st(q)},[q,o]);let Je=l.useMemo(()=>{let Q=H=>Ie(w(i.location),H,P.current),D=(H,u)=>{let v=()=>{i.transaction(()=>{var me;let f=Q(H);if(!f)return;f.go!==0&&(U.info("go to",f.go),i.go(f.go));let m=a(f.location),h=f.background?{background:a(f.background).pathname}:void 0;if(!(i.location.pathname===m.pathname&&i.location.search===m.search&&i.location.hash===m.hash&&(h==null?void 0:h.background)===((me=i.location.state)==null?void 0:me.background)))if(m.pathname.startsWith("https://")){let ue=ne(m.pathname,{search:m.search,hash:m.hash});U.info(`navigate externally with "${ue.toString()}"`,h),window.location.href=ue}else{if(n&&m.pathname!==i.location.pathname){window.location.href=ne(`${window.location.protocol}//${window.location.host}`,m);return}u!=null&&u.replace?(U.info(`replace with "${m.pathname}"`,{location:m,state:h}),i.replace({...m,state:h})):(U.info(`push "${m.pathname}"`,{location:m,state:h}),i.push({...m,state:h}))}})};u!=null&&u.suspenseTransition?je(()=>{v()}):v()},k=H=>{let{pathname:u,search:v,hash:f}=C(H);return`${u}${v||""}${f?`#${f}`:""}`},C=H=>{let u=Q(H);if(!u)return i.location;let v=a(u.location),f=u.background?{background:a(u.background).pathname}:void 0;return{...v,state:f}};return{forceHardNavigation:n,navigate:D,getNavigationURL:k,getLocationFor:C}},[n,w,a]);return l.createElement(oe.Provider,{value:q},l.createElement(Oe.Provider,{value:Je},t))}function no(){return l.useContext(oe)}async function st(e){switch(e.screen.type){case"collection":case"space":let t={...e,overlay:void 0};await T.set(it,t);break;default:break}}s();s();async function We(e,t={}){let o=await ct(e,t);return{hostname:de(),pathname:G(o).pathname.replace(/^\//,"").replace(/\/$/,"")}}async function ct(e,t={}){let o=new g(t.reader);switch(e.type){case"collection":let n=await F(()=>o.getDocument(y(e.collection)));return{type:"collection",collection:e.collection,organization:n==null?void 0:n.organization};case"space":let r=await F(()=>o.getDocument(x(e.space)));return{type:"space",space:e.space,organization:r==null?void 0:r.organization,page:""};case"user":return{type:"user",user:e.user};case"organization":return{type:"home",organization:e.organization};default:b(e)}}async function Ke(e,{reader:t}={}){let o=await F(async()=>"type"in e?await se(e,{withShareLinkSuffix:e.shareLink,reader:t}):await W(e,{withShareLinkSuffix:e.shareLink,reader:t}));return o?o:"type"in e?await We(e,{reader:t}):await We(we(e)?{type:"space",space:e.key}:{type:"collection",collection:e.key},{reader:t})}var qe={getDocument:e=>ae.readAsync(e),getCollection:e=>ae.readAsync(e)},zo=N({getKey:e=>"type"in e?be(e):["organization"in e?e.organization:e.user,e.collection,e.customHostname,e.path,e.shareLink].join("/"),getValue:async e=>await Ke(e,{reader:qe})}),To=N({getKey:e=>["organization"in e?e.organization:e.user,e.collection,e.customHostname,e.path].join("/"),getValue:async e=>await ce(e,{reader:qe})});s();var Qe=E(j());function Eo(e){let{children:t}=e;return Qe.createElement(xe,null,t)}export{V as a,z as b,Ct as c,ke as d,d as e,Ht as f,re as g,Zt as h,$e as i,en as j,M as k,tn as l,nn as m,on as n,nt as o,an as p,rn as q,O as r,sn as s,ie as t,Ln as u,Nn as v,Eo as w,T as x,to as y,no as z,zo as A,To as B};
//# sourceMappingURL=https://app.gitbook.com/public/app/chunks/chunk-IBKYVWYL.min.js.map
